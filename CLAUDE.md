# Private OCR to Markdown - Claude Code指示書

## プロジェクト固有のガイドライン

このプロジェクトは**完全ローカル処理のOCR to Markdown変換アプリケーション**です。以下のガイドラインに従って開発を進めてください。

## コミットとGit操作

- **頻繁なコミット**: 一つの機能実装や重要な変更が完了するたびに自動的にコミットとpushを行う
- **コミットメッセージ**: 日本語で簡潔に記述し、変更内容を明確にする
- **ブランチ戦略**: mainブランチで直接開発

## コード規約

### TypeScript

- 厳格な型定義を使用し、`any`型の使用は最小限に
- すべての関数とメソッドに明示的な戻り値の型を指定
- インターフェースと型エイリアスを適切に使い分ける

### React/Next.js

- **Server Components優先**: 可能な限りServer Componentsを使用
- **Client Components**: 状態管理やブラウザAPIが必要な場合のみ`'use client'`を使用
- **ファイル構成**: コンポーネントは機能ごとにディレクトリを分ける

### スタイリング

- Tailwind CSSのユーティリティクラスを使用
- shadcn/uiのコンポーネントを積極的に活用
- カスタムCSSは最小限にし、必要な場合は`@apply`ディレクティブを使用

## プライバシーとセキュリティ

### 重要な制約

1. **外部API呼び出し禁止**: 生成AI（ChatGPT等）や外部サーバーへのデータ送信は一切行わない
2. **完全ローカル処理**: すべてのOCR処理とMarkdown変換はブラウザ内で完結
3. **ネットワーク通信の制限**: 初回の学習データ（traineddata）取得を除き、ネットワーク通信を行わない

### 実装時の注意

- Web Workerを使用してメインスレッドをブロックしない
- 大容量ファイルはメモリ管理に注意し、1ページずつ処理
- ユーザーデータはローカルストレージまたはIndexedDBのみに保存

## パフォーマンス最適化

### 必須要件

- **逐次処理**: 大容量PDFは1ページずつ処理し、完了したページから順次表示
- **メモリ管理**: Canvasオブジェクトは使用後に適切に破棄
- **進捗表示**: すべての重い処理で進捗バーを表示

### 推奨事項

- 画像の前処理（グレースケール化、リサイズ）でOCR精度を向上
- IndexedDBでOCR学習データをキャッシュして2回目以降を高速化

## エラーハンドリング

### フォールバック戦略

- **推定失敗時**: 壊れた出力ではなく、プレーンテキストとして出力
- **ページ単位の独立性**: 特定のページでエラーが発生しても、他のページの処理は継続
- **ユーザーへの通知**: エラー発生時は具体的なメッセージを表示し、再試行オプションを提供

## テンプレート機能

### 実装方針

- **議事録テンプレート**: 日時、場所、議題、決定事項などのキーワードを検出
- **論文テンプレート**: 章立てを強調し、コードブロック推定を強化
- **請求書テンプレート**: 帳票形式の構造を維持したMarkdownテーブル出力

### 拡張性

- テンプレートは簡単に追加できる設計にする
- 将来的なカスタムテンプレート機能を考慮

## UI/UX要件

### デザイン原則

- **ダークモード対応**: デフォルトでダークモード対応
- **レスポンシブ**: モバイルでも閲覧可能（ただしOCR処理は重いため注意書きを表示）
- **プライバシーバッジ**: 「外部送信なし」を常に表示してユーザーに安心感を提供

### インタラクション

- ドラッグ&ドロップでファイルアップロード
- リアルタイムプレビュー（処理中も逐次表示）
- ワンクリックでMarkdownをコピー可能

## 開発の進め方

### 実装順序

1. **プロジェクト初期化**: Next.js + TypeScript + Tailwind CSSのセットアップ
2. **基本構造**: ディレクトリ構造とコンポーネント骨格の作成
3. **状態管理**: Zustandストアの実装
4. **OCR処理**: Tesseract.jsの統合とWeb Worker化
5. **変換エンジン**: Markdown変換ロジックの実装
6. **UI実装**: shadcn/uiを使用したインターフェース構築
7. **統合テスト**: エンドツーエンドのフローテスト

### コミットタイミング

以下のタイミングで自動的にコミットとpush：

- プロジェクト初期化完了時
- 各主要コンポーネントの実装完了時
- 新機能の実装完了時
- バグ修正完了時
- ドキュメント更新時

## コメント規約

### 日本語コメント

- すべてのコメントは日本語で記述
- 複雑なロジックには必ず説明コメントを追加
- TODOコメントには実装予定も記載

### JSDoc

```typescript
/**
 * OCR処理を実行し、Markdown形式に変換する
 * @param file - 処理対象のファイル（画像またはPDF）
 * @param options - OCRオプション（言語、テンプレートなど）
 * @returns Markdown形式のテキスト
 */
export async function processOcr(
  file: File,
  options: OcrOptions
): Promise<string> {
  // 実装
}
```

## 開発時の注意事項

1. **段階的実装**: 小さな機能単位で実装し、動作確認してから次に進む
2. **テスト重視**: 変換ロジックは特に入念にテストする
3. **ユーザー視点**: 「待たされている感」を減らすUIを心がける
4. **ドキュメント**: 複雑な実装は必ずコメントまたはドキュメントを残す

## 参考情報

- プロジェクトの詳細な要件は `document.md` を参照
- 技術スタックの詳細は `README.md` を参照
- プロジェクト構造は `.claude/prime.md` を参照
